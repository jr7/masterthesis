\chapter{Numerical Methods}

\section{Introduction}

This chapter focuses on the methods that are used for the numerical computations in this thesis.
In order to compute the temporal evolvement of a fluid system from its initial state, it is necessary to discretize
the equations of motion by using different numerical schemes.\\
For this purpose various discretization approaches, for example finite-element and finite-volume methods, exists.
Here we will introduce the method of finite-difference stencils for the spatial and a third order Runge-Kutta method for the discretization in time.
Furthermore we will introduce the method of artificial compressibility, which can be used to avoid the numerical expensive solution of a poisson equation.
The choice of these methods in combination with the usage of cartesian grids is in particular time saving when performing computations on the gpu, as we
will see in chapter \ref{chapter:cuda}.

\section{Finite Differencing Schemes}

We start with a brief introduction of finite difference methods.
The interested reader is referred to \citep{ferziger99} for a more general overview, from where this section is adapted.
The partial differential equations we want to solve in this thesis are of the form

\begin{align}
    \label{numerik:pde_allg}
    \pdn[\Phi]{t} = A \underbrace{\pdn[^2\Phi]{x^2}}_{\text{I}}  + B \underbrace{\pdn[^2\Phi]{x^2}}_{\text{II}}
     + C(\vec{r}, \vec{u}, t) +  \vec{u}\left(\pdn[^2\Phi]{x^2} +  \pdn[^2\Phi]{x^2} + \pdn[\Phi]{x}\right) = \mathcal{L}
\end{align}

for a variable $\Phi(x, y, z)\in\mathbb{R}$.
The numerical integration can be divided into two steps, the calculation of the differential operator $\mathcal{L}$, which we want to discuss in this
section and secondly the integration in time.
The exact calculation of the spatial derivatives in $\mathcal{L}$ is numerically not possible.\\
Due to the limited storage capacity and computation time of computers,
it is necessary to discretize the domain, on which the PDE should be solved and find a adequate approximation of these operators.
Here we will fall back to the  one-dimensional case, the implementation for three dimensions will be discussed in chapter \ref{chapter:cuda}.\\
Let $\Omega = \{x \in \mathbb{R} | 0 < x < L\}$ be the domain on which we want to solve equations of type \ref{numerik:pde_allg}.
For the discretization the simplest approach is to divide $\Omega$ into $N$ equidistant points $x_i= i\Delta x$ and $i=1..N$,
with the distance between two points given by $\Delta x = x_{i+1} - x_i = L/(N-1)$.
Local to a single point $x_i$, $f$ can be approximated with a taylor expansion.

For the discretization the simplest approach is to divide $\Omega$ into $N$ equidistant points $x_i= i\Delta x$ and $i=1..N$,
with the distance between two points given by $\Delta x = x_{i+1} - x_i = L/(N-1)$.
Local to a single point $x_i$, $f$ can be approximated with a taylor expansion.

\begin{align}
    f(x) = f(x_i) + \left(\pdn[f]{x} \right)_i (x - x_i) + \left(\pdn[^2f]{x^2}\right)_i \frac{(x-x_i)^2}{2!} + bla
\end{align}

Insert $x$ with $x_{i+1}$ or $x_{i-1}$ we obtain the forward and backward

 necgleting higher order terms, results in the following approximations for the first derivative.

\begin{align}
    \left(\pdn[f]{x}\right)_i &\approx \frac{f_{i+1} - f{i}}{\Delta x}\\
    \left(\pdn[f]{x}\right)_i &\approx \frac{f_{i} - f_{i-1}}{\Delta x}\\
    \left(\pdn[f]{x}\right)_i &\approx \frac{f_{i+1} - f_{i-1}}{2\Delta x}
\end{align}

\begin{figure}[!tpb]
  \centering
    \resizebox{.8\linewidth}{!}{
   \import{gfx/numerik/}{finite_differenzen.pdf_tex}
  }

  \caption{Approximation of the function $\Phi$ by different finite difference schemes.}
\end{figure}

The first scheme is äquivalent to the definition of the first derivative, for $\Delta x \rightarrow 0$ and is also
denoted as forward difference, whereas the second scheme usually is referred to as backward difference.
The third approximation can be obtained by averaging over the first two approximations, and  is referred to as central difference.
The error resulting in the neglection of higher order terms in the taylor approximation, is denoted as the truncation error.
For the forward- and backward scheme this error is of first order, for the central scheme it is of second order.
All schemes are schematicaly shown in figure (), here the secord order central schemes results in the best approximationn.
\citep{Fornberg1988}


\paragraph{Second Order}\mbox{}\\
\begin{align}
    \left(\pdn[f]{x}\right)_i &\approx \frac{f_{i+1} - f_{i-1}}{2\Delta x} \\
    \left(\pdn[^2f]{x^2}\right)_i &\approx \frac{f_{i+1} - 2 f_i +  f_{i-1}}{2\Delta x^2}
\end{align}
\paragraph{Fourth Order}\mbox{}\\
\begin{align}
    \left(\pdn[f]{x}\right)_i &\approx \frac{-f_{i+2} + 8f_{i+1} - 8f_{i-1} + f_{i-2}}{12\Delta x} \\
    \left(\pdn[^2f]{x^2}\right)_i &\approx \frac{-f_{i+2} + 16f_{i+1} -30f_i + 16f_{i-1} - f_{i-2}}{12\Delta x^2} \\
\end{align}

\newpage

\section{Runge Kutta Method}

For the temporal discretization the third-order low-storage Runge-Kutta scheme is used, first introduced by [Williamson].
Third order methods are often used for cfd-simulations, since they tend to stabilice numerical oscilltions in advection terms[].\\
We begin with considering the inital value problem.

\begin{align}
    \left(\pdn[f]{t}\right) = F(t, f(t)) ; f(t_0) = f_0
\end{align}

This differtial equation can be solved by integration, with the exact solution
\begin{align}
    f(t) = f(0) + \int_{t_n}^{t}F(t, f(t))dt
\end{align}
In the next step the integral is splitted into piecewiese integration, with time intervalls $[t^n, t^{n+1}]$.
\begin{align}
    f(t^{n+1}) = f(t) + \int_{t_n}^{t_{n+1}}F(t, f(t))dt
\end{align}

When using runge kutta methods, the function F(t, f(t)) is evaluated at $s$ different timesteps $\tau_i = t^n + \Delta t \alpha_i$,
furthermore for each $\tau$ a different weight parameter $b_i$ is used.V
The numerical computation of the integral is than given by [].

\begin{align}
    f(t^{n+1}) = f(t) + \Delta t \sum_{i=1}^s b_i k_i, k_i = F(t^n + \Delta t c_s, f^n + \Delta t \sum_{i=1}^{s-1}a_{si}k_i)
\end{align}

With the definition of $\sum c_i$, the runge kutta scheme of third order is festgelegt by the butcher tablau
By using taylor expansion and coefficient comparison, it can be shown that this  method converges at third order.


- In order to use as  so wenig speicher wie möglich williamson scheme
- 2 speicherstack für jede variable

\begin{align}
    S_1 = \delta t F(f^n ; f^(1) = f^n + \frac{S_1}{3}) \\
    S_1 = \delta t F(f^n ; f^(1) = f^n + \frac{S_1}{3}) \\
    S_1 = \delta t F(f^n ; f^(1) = f^n + \frac{S_1}{3}) \\
\end{align}


-stabilitätsregion

\section{Numerical Stability}\mbox{}\\

-beispiel erste abl dann zweit
-stabilität konstistenz - konvergenz etc
-verfahren höherer ordnung
-peclet zahl
-upwind schema



\newpage

\section{Artificial Kompressibility}
bewegungsgleichungen
druckterm diskussion
exkurs laplace gleichung
beispiel rayleigh benard diskretisierung

